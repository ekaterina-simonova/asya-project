"""
Менеджер промптов для системы "Ася".

Этот модуль — **единственный источник истины** для системного промпта.
Все логика диалога, управление агентами, правила обработки, защита —
записаны в файле `prompts/full_prompt.txt`.

Этот файл НЕ обрабатывает, НЕ модифицирует, НЕ парсит промпт.
Он просто загружает его и отдает LLM.

Цель: изолировать промпт от остального кода, чтобы его можно было
обновлять без перезапуска системы.
"""

import os

# Путь к файлу с полным промптом
_PROMPT_FILE_PATH = os.path.join(os.path.dirname(__file__), "../prompts/full_prompt.txt")


def load_full_prompt() -> str:
    """
    Загружает и возвращает полный системный промпт из файла.

    Этот промпт — основа всей логики диалога "Аси".
    Он содержит:
    - Инструкции для LLM
    - Описание веток, блоков, агентов
    - Правила поведения, защиты, форматирования ответа

    Не изменяйте этот файл в коде — он должен быть **только для чтения**.
    Обновляйте его вручную в /prompts/full_prompt.txt.

    Returns:
        str: Полный текст промпта в виде строки.
    """
    try:
        with open(_PROMPT_FILE_PATH, 'r', encoding='utf-8') as f:
            prompt = f.read().strip()
            if not prompt:
                raise ValueError(f"Файл промпта '{_PROMPT_FILE_PATH}' пуст.")
            return prompt
    except FileNotFoundError:
        raise FileNotFoundError(
            f"Файл промпта не найден: {_PROMPT_FILE_PATH}\n"
            "Убедитесь, что файл 'prompts/full_prompt.txt' существует "
            "в корне проекта."
        )
    except Exception as e:
        raise RuntimeError(f"Ошибка при чтении файла промпта: {str(e)}")


# --- Для удобства в тестах и отладке ---
# Это не используется в продакшене, но может быть полезно при разработке.
if __name__ == "__main__":
    # Пример: вывести промпт в консоль для проверки
    print("=== FULL_PROMPT ===")
    print(load_full_prompt())
    print("\n=== END PROMPT ===")